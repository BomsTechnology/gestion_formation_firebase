import{o as B,c as z,a as j,e as U,g as i,f as E,t as I,j as m,V as y,u as V,q as v,s as C,v as f,x as h,y as $,z as H,A as R,B as D,I as F,D as w,C as N,E as A,U as M,S as G,G as K}from"./index.c77e1f43.js";import{_ as L}from"./ConfirmDeleteModal.204134a5.js";function O(g,n){return B(),z("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[j("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z","clip-rule":"evenodd"})])}const J={class:"relative z-10","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},P={class:"fixed inset-0 z-10 overflow-y-auto"},Q={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},W={class:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},X={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Y={class:"sm:flex sm:items-start"},Z={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10"},ee={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ae=i("h3",{class:"text-lg font-medium leading-6 text-gray-900",id:"modal-title"}," Registration ",-1),te={class:"mt-2"},se={class:"text-sm text-gray-500"},ne={class:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6"},oe={__name:"ConfirmRegistrationModal",props:{question:{type:String}},emits:["confirm","cancel"],setup(g,{emit:n}){const p=g;return(o,a)=>(B(),U("div",J,[i("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:a[0]||(a[0]=d=>n("cancel"))}),i("div",P,[i("div",Q,[i("div",W,[i("div",X,[i("div",Y,[i("div",Z,[j(E(O),{class:"h-8 w-8 text-blue-600"})]),i("div",ee,[ae,i("div",te,[i("p",se,I(p.question),1)])])])]),i("div",ne,[i("button",{onClick:a[1]||(a[1]=d=>n("confirm")),type:"button",class:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-500 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-secondary-color focus:outline-none focus:ring-2 focus:ring-secondary-color focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm"}," Registration "),i("button",{onClick:a[2]||(a[2]=d=>n("cancel")),type:"button",class:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cancel ")])])])])]))}};function ve(){const g=V(),n=m(""),p=y(v,"trainings"),o=m(0),a=m([]),d=m([]),c=m([]),r=m([]),b=m(!1),x=async e=>{const t=f(h,e);let s;return await K(t).then(u=>{s=u}).catch(u=>{switch(u.code){case"storage/object-not-found":n.value="File doesn't exist";break;case"storage/unauthorized":n.value="User doesn't have permission to access the object";break;case"storage/canceled":n.value="ser canceled the upload";break;case"storage/unknown":n.value="Unknown error occurred, inspect the server response";break;default:n.value="errors to get image";break}}),s},_=async()=>{o.value=1,d.value=[],r.value=[],(await C(p).catch(t=>{n.value=t.message})).forEach(t=>{let s=t.data();s.id=t.id,d.value.push(s),r.value.push({id:s.id,image:s.image,value:!1})}),k(!1),o.value=0},q=async e=>{o.value=1,n.value="",e.image=new File([e.image],`${new Date().getTime()}_${e.image.name}`);const t=f(h,`training/${e.image.name}`);await $(t,e.image).then(s=>{console.log("Uploaded a blob or file!")}),await x(`training/${e.image.name}`).then(s=>{e.url=s}),await H(p,{name:e.name,price:e.price,day:e.day,description:e.description,startHour:e.startHour,endHour:e.endHour,category:e.category,teacher:e.teacher,image:e.url}).catch(s=>{n.value=s.message,o.value=0}),o.value=0,g.push({name:"admin.training.index"})},S=async e=>{r.value[e].value?c.value.push({id:r.value[e].id,image:r.value[e].image}):c.value.splice(e,1)},k=async(e=!0)=>{if(e)if(b.value)for(const t in r.value)r.value[t].value=!0,c.value.push(r.value[t].id);else{for(const t in r.value)r.value[t].value=!1;c.value=[]}else{for(const t in r.value)r.value[t].value=!1;c.value=[]}};return{registration:async e=>{o.value=1,n.value="";const{reveal:t,onConfirm:s}=R(oe,{question:"Are you sure you want to register for this course?"});s(async()=>{await H(y(v,"registrations"),e).catch(u=>{n.value=u.message,o.value=0}),g.push({name:"account"}),o.value=0}),t()},getTrainingByCategory:async e=>{o.value=1,d.value=[];const t=y(v,"trainings"),s=M(t,G("category.id","==",e));(await C(s).catch(l=>{console.log(l.message),n.value=l.message})).forEach(l=>{let T=l.data();T.id=l.id,d.value.push(T)}),o.value=0},updateTraining:async e=>{o.value=1,n.value="";const t=w(v,"trainings",e);if(a.value.newImage){const s=f(h,a.value.image);await D(s).then(()=>{console.log("Deleted old file!")}).catch(l=>{n.value=l.message}),a.value.image=new File([a.value.newImage],`${new Date().getTime()}_${a.value.newImage.name}`);const u=f(h,`training/${a.value.image.name}`);await $(u,a.value.image).then(l=>{console.log("Uploaded a blob or file!")}),await x(`training/${a.value.image.name}`).then(l=>{a.value.url=l}),await A(t,{name:a.value.name,price:a.value.price,day:a.value.day,description:a.value.description,startHour:a.value.startHour,endHour:a.value.endHour,category:a.value.category,teacher:a.value.teacher,image:a.value.url}).catch(l=>{n.value=l.message})}else await A(t,{name:a.value.name,price:a.value.price,day:a.value.day,description:a.value.description,startHour:a.value.startHour,endHour:a.value.endHour,teacher:a.value.teacher,category:a.value.category}).catch(s=>{n.value=s.message});g.push({name:"admin.training.index"}),o.value=0},getTraining:async e=>{o.value=1;const t=w(v,"trainings",e),s=await N(t);s.exists()?a.value=s.data():n.value="No such document!",o.value=0},training:a,deleteTraining:async()=>{if(c.value.length!=0){const{reveal:e,onConfirm:t}=R(L,{question:"Are you sure you want to delete its item(s)? All data will be permanently deleted. This action cannot be undone."});t(async()=>{for(const s in c.value){const u=f(h,c.value[s].image);await D(u).then(()=>{console.log("Deleted file!")}).catch(l=>{n.value=l.message}),await F(w(v,"trainings",c.value[s].id)).catch(l=>{n.value=l.message})}_()}),e()}},toogleDeleteArray:S,checkAll:k,getTrainings:_,deleteArray:c,chks:r,chkAll:b,trainings:d,loading:o,errors:n,createTraining:q,cleanErrors:()=>{n.value=""}}}export{ve as u};
