import{j as c,V as E,b as R,M as k,u as C,q as r,s as S,N as L,z as I,O,P as _,Q as G,R as T,A as V,I as Y,D as m,U as j,S as z,E as w}from"./index.c77e1f43.js";import{_ as K}from"./ConfirmDeleteModal.204134a5.js";function J(){const v=C(),l=c(""),g=E(r,"users"),t=c(0),u=c([]),p=c([]),n=c([]),o=c([]),y=c(!1),b=R(),U=k(),h=async()=>{t.value=1,p.value=[],(await S(g).catch(e=>{l.value=e.message})).forEach(e=>{let s=e.data();s.id=e.id,p.value.push(s),o.value.push({id:s.id,image:s.image,value:!1})}),A(!1),t.value=0},D=async a=>{t.value=1,l.value="";const e=k();await L(e,a.email,a.password).then(s=>{u.value=s.user}).catch(s=>{l.value=s.message}),await I(g,{email:a.email,phone:a.phone,type:a.type,name:a.name,state:a.state,userId:u.value.uid,image:""}).catch(s=>{l.value=s.message,t.value=0}),await O(e.currentUser,{displayName:a.name,phoneNumber:a.phone}),t.value=0,location.href="/"},N=async a=>{t.value=1,await _(U,a.email,a.password).then(async e=>{const s=e.user;await f(s.uid),u.value.state==1?(u.value.type=="admin"?v.push({name:"admin.dashboard"}):location.href="/",console.log("Successfully Logged in")):(b.logOut(),t.value=0,l.value="Your account has been blocked")}).catch(e=>{switch(console.log(e.code),e.code){case"auth/invalid-email":l.value="Invalid Email";break;case"auth/user-not-found":l.value="No account with that email was found";break;case"auth/wrong-password":l.value="Incorrect password";break;default:l.value="Email or password was incorrect";break}t.value=0})},P=async()=>{t.value=1;const a=new G;await T(U,a).then(async e=>{const s=e.user;await f(s.uid),u.value?u.value.state==1?(u.value.type=="admin"?v.push({name:"admin.dashboard"}):location.href="/",console.log("Successfully Logged in")):(b.logOut(),t.value=0,l.value="Your account has been blocked"):(await I(g,{email:s.email,phone:s.phoneNumber,type:"user",name:s.displayName,state:1,userId:s.uid,image:s.photoURL}).catch(d=>{l.value=d.message,t.value=0}),v.push({name:"home"}))}).catch(e=>{console.log(e.message),t.value=0})},q=async a=>{o.value[a].value?n.value.push({id:o.value[a].id,image:o.value[a].image}):n.value.splice(a,1)},A=async(a=!0)=>{if(a)if(y.value)for(const e in o.value)o.value[e].value=!0,n.value.push(o.value[e].id);else{for(const e in o.value)o.value[e].value=!1;n.value=[]}else{for(const e in o.value)o.value[e].value=!1;n.value=[]}},W=async()=>{if(n.value.length!=[]){const{reveal:a,onConfirm:e}=V(K,{question:"Are you sure you want to delete its item(s)? All data will be permanently deleted. This action cannot be undone."});a(),e(async()=>{for(const s in n.value)await Y(m(r,"users",n.value[s].id)).catch(d=>{l.value=d.message});h()})}},f=async a=>{t.value=1,u.value=null;const e=E(r,"users"),s=j(e,z("userId","==",a));(await S(s).catch(i=>{console.log(i.message),l.value=i.message})).forEach(i=>{u.value=i.data(),u.value.id=i.id}),t.value=0};return{loginWithEmail:N,loginWithGoogle:P,enabledUser:async a=>{l.value="";const e=m(r,"users",a);await w(e,{state:1}).catch(s=>{l.value=s.message}),h()},disableddUser:async a=>{l.value="";const e=m(r,"users",a);await w(e,{state:2}).catch(s=>{l.value=s.message}),h()},updateUser:async a=>{t.value=1,l.value="";const e=m(r,"users",a);await w(e,{...u.value}).catch(s=>{l.value=s.message}),t.value=0,v.push({name:"user.index"})},getUser:f,user:u,deleteUser:W,toogleDeleteArray:q,checkAll:A,getUsers:h,deleteArray:n,chks:o,chkAll:y,users:p,loading:t,errors:l,createUser:D,cleanErrors:()=>{l.value=""}}}export{J as u};
